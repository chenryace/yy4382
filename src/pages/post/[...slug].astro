---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostAttr from "../../components/PostAttr.astro";
import PrevNext from "../../components/PrevNext.astro";
import MdRender from "../../components/MdRender.astro";
import "../../styles/markdown.css";
import CommentCard from "../../components/CommentCard.vue";

export async function getStaticPaths() {
  const blogEntries = await getCollection("post");
  return blogEntries
    .sort(
      (a, b) =>
        new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
    )
    .map((post, i) => ({
      params: { slug: post.slug },
      props: { post, prev: blogEntries[i - 1], next: blogEntries[i + 1] },
    }));
}

const { post, prev, next } = Astro.props;

const { Content, headings } = await post.render();
---

<BaseLayout pageTitle={post.data.title} tocList={headings}>
  <div class="flex flex-col gap-4">
    <div class="p-4 pt-4 lg:p-8 card-color rounded-xl">
      <h1
        class="text-xl lg:text-3xl font-semibold tracking-tight text-black/90 dark:text-white/90 text-wrap mb-4 relative
        before:w-1 before:h-5 before:rounded-md before:bg-primary
        before:absolute before:top-2 before:-left-4 before:hidden lg:before:block"
      >
        {post.data.title}
      </h1>
      <PostAttr post={post} />
      <MdRender>
        <Content />
      </MdRender>
    </div>
    <PrevNext prev={prev} next={next} />
    <CommentCard client:visible path={"/post/" + post.slug} />
  </div>
</BaseLayout>
