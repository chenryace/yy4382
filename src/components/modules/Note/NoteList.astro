---
import type { getEntries } from "@libs/notion-client";
import NoteCard from "./NoteCard.astro";
import NoteCardContent from "./NoteCardContent.astro";
import NoteLoading from "./NoteLoading.astro";
const baseUrl = new URL(Astro.request.url);
let response = await fetch(`${baseUrl.origin}/api/note`);

const pages = (await response.json()) as Awaited<ReturnType<typeof getEntries>>;
---

<div class="flex flex-col gap-4">
  {
    pages.map((page) => (
      <NoteCard>
        <Fragment slot="title">{page.title}</Fragment>
        <div slot="meta">
          <span>{page.createdAt}</span>
        </div>
        <NoteCardContent server:defer pageId={page.id}>
          <div slot="fallback">
            <NoteLoading />
          </div>
        </NoteCardContent>
      </NoteCard>
    ))
  }
</div>
