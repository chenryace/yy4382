---
import { getCollection } from "astro:content";
import SideCard from "./SideCard.astro";
const allPosts = await getCollection("post");
const tagsWithCount = allPosts.reduce((acc: Record<string, number>, post) => {
  post.data.tags.forEach((tag) => {
    if (acc[tag]) {
      acc[tag]++;
    } else {
      acc[tag] = 1;
    }
  });
  return acc;
}, {});
interface Props {
  showAll?: boolean;
}
const { showAll = false } = Astro.props;
const maxTags = showAll ? Object.keys(tagsWithCount).length : 9;
---

<SideCard cardTitle={showAll ? "标签" : "热门标签"} cardLink="/tags">
  <div class="flex flex-wrap">
    {
      Object.keys(tagsWithCount)
        .slice(0, maxTags)
        .map((tag) => (
          <a
            href={`/tags/${tag}`}
            class="inline-block rounded-lg text-sm leading-loose px-2 text-content"
          >
            #{tag}
          </a>
        ))
    }
  </div>
</SideCard>
